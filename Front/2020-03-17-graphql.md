# GraphQL ì•Œì•„ë³´ê¸°

- Title : GraphQL ì•Œì•„ë³´ê¸°
- Date : 2020-03-17
- Category : í”„ë¡ íŠ¸

# Why?

TIL ë ˆíŒŒì§€í† ë¦¬ì˜ ë¬¸ì„œë“¤ì„ ì–»ê¸° ìœ„í•´ Github Content APIë¥¼ ì´ìš©í–ˆë‹¤. ë£¨íŠ¸ í´ë”ë“¤, ê° í´ë”ì˜ ë¬¸ì„œë“¤, ë¬¸ì„œì˜ ë‚´ìš© ë“±ì„ REST APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì–»ì—ˆëŠ” ë° ì•„ë¬´ë˜ë„ ì—”ë“œ í¬ì¸íŠ¸ê°€ ë§ë‹¤ ë³´ë‹ˆ ì½”ë“œê°€ ë³µì¡í•´ì¡Œë‹¤. ë˜ ë‚´ê°€ ì›í•˜ëŠ” ë°ì´í„°ë§Œ ë°›ê³  ì‹¶ì€ ë° ì‘ë‹µ êµ¬ì¡°ê°€ ì •í•´ì ¸ìˆë‹¤ë³´ë‹ˆ ì‘ë‹µ ë°ì´í„°ë¥¼ ì§ì ‘ ê°€ê³µí•˜ëŠ” ìˆ˜ ë°–ì— ì—†ì—ˆë‹¤. íœ´ ë¶ˆí¸í•˜ë„¤~ ğŸ˜¥ ë¶ˆí¸í•˜ë‹¤. ìƒê°í•˜ë˜ ì¤‘ Githubì´ GraphQL APIë¥¼ ì œê³µí•œë‹¤ëŠ” ê²ƒì„ ë°œê²¬í–ˆë‹¤. ì˜ˆì „ì— ì ê¹ ê³µë¶€í–ˆì„ ë•ŒëŠ” REST APIë³´ë‹¤ ì™œ í¸í•œì§€ ì´í•´ë¥¼ ëª»í–ˆëŠ” ë° ì—­ì‹œ ì‚¬ëŒì€ ëª¸ì†Œ ê²ªì–´ë´ì•¼ ì•„ë‚˜ë³´ë‹¤. ì§ì ‘ ì‚¬ìš©í•´ë³´ë‹ˆ ë„ˆë¬´ ë„ˆë¬´ í¸í–ˆë‹¤. ê·¸ë˜ì„œ ì˜¤ëŠ˜ì˜ TILì€ GraphQLì— ëŒ€í•´ ì •ë¦¬í•´ë³´ë ¤í•œë‹¤. 

# âœ¨ GraphQL ì´ë€?

GraphQL(gql)ëŠ” APIë¥¼ ìœ„í•œ ì¿¼ë¦¬ ì–¸ì–´ë¡œ API ì„œë²„ì—ì„œ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. GraphQLì„ ì‚¬ìš©í•˜ëŠ” ì•±ì€ ëŠë¦° ëª¨ë°”ì¼ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì—ì„œë„ ë¹ ë¥´ê²Œ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤ê³  í•œë‹¤. 

GraphQL API ì„œë²„ëŠ” gqlë¡œ ì‘ì„±ëœ ì¿¼ë¦¬ë¥¼ ì…ë ¥ìœ¼ë¡œ ë°›ê³  ì¿¼ë¦¬ë¥¼ ì²˜ë¦¬í•œ ê²°ê³¼ë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ëŒë ¤ì¤€ë‹¤. HTTP API ì²˜ëŸ¼ gqlë„ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ë‚˜ í”Œë«í¼ì— ì¢…ì†ì ì´ì§€ì•Šë‹¤.

ë„¤íŠ¸ì›Œí¬ ë°©ì‹ì—ë„ ì¢…ì†ì ì´ì§€ ì•Šë‹¤. ì¼ë°˜ì ìœ¼ë¡œ gqlì˜ ì¸í„°í˜ì´ìŠ¤ê°„ ì†¡ìˆ˜ì‹ ì€ ë„¤íŠ¸ì›Œí¬ ë ˆì´ì–´ L7ì˜ HTTP POST ë©”ì„œë“œì™€ ì›¹ ì†Œì¼“ í”„ë¡œí† ì½œì„ í™œìš©í•œë‹¤. í•„ìš”ì— ë”°ë¼ì„œëŠ” L4ì˜ TCP/UDPë‚˜ L2ì˜ ì´ë”ë„· í”„ë ˆì„ì„ í™œìš©í•  ìˆ˜ ìˆë‹¤.

## REST APIì™€ ì°¨ì´ì ?

- REST APIê°€ ì—¬ëŸ¬ URLì—ì„œ ë°ì´í„°ë¥¼ ì–»ëŠ” ê²ƒê³¼ ë‹¬ë¦¬ GraphQLì€ ëª¨ë“  ë°ì´í„°ë¥¼ í•˜ë‚˜ì˜ ì—”ë“œ í¬ì¸íŠ¸ë¥¼ í†µí•´ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.
- REST APIëŠ” ê° ì—”ë“œí¬ì¸íŠ¸ë§ˆë‹¤ ë°ì´í„°ë² ì´ìŠ¤ SQL ì¿¼ë¦¬ê°€ ë‹¬ë¼ì§€ê³  gql APIëŠ” gql ìŠ¤í‚¤ë§ˆ íƒ€ì…ë§ˆë‹¤ ë°ì´í„°ë² ì´ìŠ¤ SQL ì¿¼ë¦¬ê°€ ë‹¬ë¼ì§„ë‹¤.
- REST APIëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ URLë¡œ í‘œí˜„í•˜ê³  GraphQLì€ Queryë¡œ í‘œí˜„í•œë‹¤ê³  í•  ìˆ˜ ìˆë‹¤.

# GraphQL êµ¬ì¡°

## ğŸ“Œ Query

HTTP Methodì˜ `GET` ê³¼ ë¹„ìŠ·

### **Fields**

    {
    	players {
    		name
    	}
    }

    {
    	"data": {
    		"players": [
    			{
    			   "name": "Pogba"
    			 },
    			 {
    			   "name": "Lukaku"
    			 },
    			 {
    			   "name": "Rashford"
    			 },
    			 {
    			   "name": "Marshal"
    			 }
    		]
    	}
    }

- ê°ì²´ì—ì„œ ì›í•˜ëŠ” í•„ë“œë§Œ ë¦¬í„´ ë°›ì„ ìˆ˜ ìˆë‹¤.
- ì¿¼ë¦¬ëŠ” í•œë²ˆì˜ ìš”ì²­ìœ¼ë¡œ ê°ì²´ë‚˜ í•„ë“œë¥¼ ìˆœíšŒí•˜ì—¬ ê´€ë ¨ëœ ë°ì´í„°ë“¤ë„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. ì´ëŸ° ì‘ì—…ì„ REST APIì—ì„œ í•˜ë ¤ë©´ API í˜¸ì¶œì„ ì—¬ëŸ¬ ë²ˆ í•´ì•¼í•œë‹¤.

### **Arguments**

    {
    	player(id: "Pogba") {
    		name
    		kit {
    	    shirtSize,
          bootSize
        }
    	}
    }

    {
    	"data": {
    		"players": {
    			"name": "Pogba",
    			"kit": [
    				{
    					"shirtSize": "large",
               "shoeSize": "medium"
    				}			
    			]
    		}
    	}
    }

- argumentsë¥¼ ì¿¼ë¦¬ì˜ í•„ë“œ ë° ì¤‘ì²©ëœ ê°ì²´ë“¤ì— ì „ë‹¬í•˜ì—¬ ì›í•˜ëŠ” ë°ì´í„°ë§Œ ì–»ì„ ìˆ˜ ìˆë‹¤
- REST APIì—ì„œ ?name=Pogba ë˜ëŠ” /Pogba (/:name í˜•ì‹ì¼ ë•Œ) ì™€ ê°™ì€ ëª©ì ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.

### Aliases

    {
    	player(id: "Pogba") {
    		name
    		kit {
    	    shirtSize,
          bootSize
        }
    	}
    	player(id: "Lukaku") {
    		name
    		kit {
    	    shirtSize,
          bootSize
        }
    	}
    }

    {
    	player1: player(id: "Pogba") {
    		name
    		kit {
    	    shirtSize,
          bootSize
        }
    	}
    	player2: player(id: "Lukaku") {
    		name
    		kit {
    	    shirtSize,
          bootSize
        }
    	}
    }

    {
    	"data": {
    		"player1": {
    			"name": "Pogba",
    			"kit": [
    				{
    					"shirtSize": "large",
               "shoeSize": "medium"
    				}			
    			]
    		}
    		"player2": {
    			"name": "Lukaku",
    			"kit": [
    				{
    					"shirtSize": "extralarge",
               "shoeSize": "large"
    				}			
    			]
    		}
    	}
    }

- í•„ë“œ ì´ë¦„ì„ ê²¹ì³ì„œ ì‚¬ìš©í•  ìˆ˜ëŠ” ì—†ê¸°ì— ì™¼ìª½ì²˜ëŸ¼ í•  ìˆ˜ ì—†ë‹¤. ì˜¤ë¥¸ìª½ ì²˜ëŸ¼ ë³„ì¹­ì„ ì¨ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

### Operation name

    query PlayerDetails {
    	player(id: "Pogba") {
    		name
    		kit {
    	    shirtSize,
          bootSize
        }
    	}
    }

- Operation Type: query, mutationê³¼ ê°™ì€ í‚¤ì›Œë“œ
- Operation Name: ì´ ì‘ì—…ì´ ë¬´ìŠ¨ ì¼ì„ í•˜ëŠ” ì§€(ë©”ì†Œë“œ ëª…ì²˜ëŸ¼..?)

### Variables

    query PlayerDetails($id: String) {
    	player(id: $id) {
    		name
    		kit {
    	    shirtSize,
          bootSize
        }
    	}
    }

- argumentsë¥¼ ë™ì ìœ¼ë¡œ ë°›ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•œë‹¤.
- Operation Name ì˜†ì— ë³€ìˆ˜ë¥¼ $ë³€ìˆ˜ì´ë¦„: íƒ€ì… í˜•íƒœë¡œ ì •ì˜í•œë‹¤. ë§Œì•½  `String!` í˜•íƒœë¡œ ì •ì˜í–ˆë‹¤ë©´ idëŠ” **ë°˜ë“œì‹œ** Stringì´ì–´ì•¼ í•œë‹¤.
- ì‹¤ì œ argumentë¡œ ì‚¬ìš©í•˜ë ¤ë©´ í•„ë“œëª…: $ë³€ìˆ˜ì´ë¦„ í˜•íƒœë¡œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
- ì „ë‹¬ëœ ë³€ìˆ˜ê°€ ì—†ìœ¼ë©´ ë””í´íŠ¸ë¡œ ì‚¬ìš©í•  ê°’ì„ ì •ì˜í•  ìˆ˜ë„ ìˆë‹¤. `$id: String = "Pogba"` í˜•íƒœë¡œ ì“°ë©´ ëœë‹¤.

### Fragments

    {
    	player(id: "Pogba") {
    		name
    		kit {
    	    shirtSize,
          bootSize
        }
    	}
    	player(id: "Lukaku") {
    		name
    		kit {
    	    shirtSize,
          bootSize
        }
    	}
    }

    {
    	player1: player(id: "Pogba") {
    		...playerKit
    	}
    	player2: player(id: "Lukaku") {
    		...playerKit
    	}
    }
    
    fragment playerKit on player {
    	name,
    	kit {
    		shirtSize,
    		shoeSize
    	}
    }

- ì™¼ìª½ì„ ë³´ë©´ nameê³¼ kitì´ ë°˜ë³µëœë‹¤. ì´ì²˜ëŸ¼ ë™ì¼í•œ êµ¬ì¡°ì˜ í•„ë“œë¥¼ ê°€ì ¸ì˜¬ ë•Œ fragment ë¥¼ ì´ìš©í•˜ë©´ ì˜¤ë¥¸ìª½ì²˜ëŸ¼ ê°„í¸í•˜ê²Œ ì“¸ ìˆ˜ ìˆë‹¤.

### Inline Fragments

    query HeroForEpisode($ep: Episode!) {
      hero(episode: $ep) {
        name
        ... on Droid {
          primaryFunction
        }
        ... on Human {
          height
        }
      }
    }

    {
      "data": {
        "hero": {
          "name": "R2-D2",
          "primaryFunction": "Astromech"
        }
      }
    }

- ìœ„ ì¿¼ë¦¬ì—ì„œ hero í•„ë“œëŠ” $ep ì¸ìˆ˜ì— ë”°ë¼ Human ë˜ëŠ” Droid íƒ€ì…ì¸ Character ì¸í„°í˜ì´ìŠ¤ë¥¼ ë¦¬í„´í•œë‹¤.
- ìœ„ ì¿¼ë¦¬ì˜ name í•„ë“œëŠ” Character ì¸í„°í˜ì´ìŠ¤ì— ìˆëŠ” ê°’ì´ë‹¤.
- Fragmentì˜ íƒ€ì… ì§ˆì˜ ê¸°ëŠ¥ì„ ì´ìš©í•˜ë©´ Human íƒ€ì…ì¼ ë•Œ, Droid íƒ€ì…ì¼ ë•Œ ê°€ì ¸ì˜¬ ë°ì´í„°ë¥¼ ì •ì˜í•  ìˆ˜ ìˆë‹¤.
- ì–´ë–¤ í•„ë“œê°€ Interfaceë‚˜ union íƒ€ì…ìœ¼ë¡œ ë¦¬í„´ëœë‹¤ë©´ inline fragmentë¡œ ì›í•˜ëŠ” ë°ì´í„°ë§Œ ë°›ì„ ìˆ˜ ìˆë‹¤.

    interface Character {
      id: ID!
      name: String!
      friends: [Character]
      appearsIn: [Episode]!
    }
    
    type Human implements Character {
      id: ID!
      name: String!
      friends: [Character]
      appearsIn: [Episode]!
      starships: [Starship]
      totalCredits: Int
    }
    
    type Droid implements Character {
      id: ID!
      name: String!
      friends: [Character]
      appearsIn: [Episode]!
      primaryFunction: String
    }

### Directives

    query PlayerDetails ($playerShirtDirective: Boolean!){
        player(id: "Pogba") {
            name,
            kit {
                shirtSize @skip(if: $playerShirtDirective)
                bootSize
            }
        }
    }

- íŠ¹ì • í•„ë“œë¥¼ í¬í•¨í•  ì§€, ìŠ¤í‚µí•  ì§€ë¥¼ ì •í•  ìˆ˜ ìˆë‹¤.
- @skip : trueë©´ ìŠ¤í‚µ
- @include : trueë©´ í¬í•¨

## ğŸ“Œ Mutation

HTTP Methodì˜ `POST` `PATCH` `DELETE` ì™€ ë¹„ìŠ·

    mutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) {
      createReview(episode: $ep, review: $review) {
        stars
        commentary
      }
    }

    {
      "ep": "JEDI",
      "review": {
        "stars": 5,
        "commentary": "This is a great movie!"
      }
    }

    {
      "data": {
        "createReview": {
          "stars": 5,
          "commentary": "This is a great movie!"
        }
      }
    }

**ì°¸ê³ **

[GraphQL ê°œë…ì¡ê¸°](https://tech.kakao.com/2019/08/01/graphql-basic/)

[Understanding Queries in GraphQL | DigitalOcean](https://www.digitalocean.com/community/tutorials/understanding-queries-in-graphql)